// /scripts/site-shell.js
(function () {
  const isInPages = location.pathname.includes("/pages/");
  const root = isInPages ? ".." : ".";
  const navItems = [
    { href: `${root}/index.html`, label: "The Gate" },
    { href: `${root}/pages/torah-first.html`, label: "Torah First" },
    { href: `${root}/pages/seven-laws.html`, label: "The Seven Laws" },
    { href: `${root}/pages/study-paths.html`, label: "Study Paths" },
    { href: `${root}/pages/chavruta.html`, label: "Chavruta" },
    { href: `${root}/pages/trees.html`, label: "The Trees" },
    { href: `${root}/pages/library.html`, label: "The Library" },
  ];

  function samePath(a, b) {
    // normalize trailing slash + default index
    const norm = (p) =>
      p.replace(/\/$/, "").replace(/\/index\.html$/, "").toLowerCase();
    return norm(a) === norm(b);
  }

  function renderHeader() {
    const header = document.querySelector(".site-header");
    if (!header) return;

    header.innerHTML = `
      <div class="header-inner">
        <a class="brand" href="${root}/index.html" aria-label="LuminaNexus Home">
          <div class="brand-mark">✦</div>
          <div class="brand-text">
            <div class="brand-title">LuminaNexus</div>
            <div class="brand-sub">Torah-first study partner</div>
          </div>
        </a>

        <nav class="pill-nav" aria-label="Primary">
          ${navItems
            .map((n) => {
              const active = samePath(location.pathname, new URL(n.href, location.origin).pathname);
              return `<a class="pill ${active ? "is-active" : ""}" href="${n.href}">${n.label}</a>`;
            })
            .join("")}
        </nav>

        <div class="header-actions">
          <a class="pill ghost" href="${root}/pages/ivrit-haor.html">Ivrit HaOr</a>
          <a class="pill ghost" href="${root}/pages/about.html">About</a>
          <a class="pill ghost" href="${root}/pages/blessing.html">Blessing</a>
        </div>
      </div>
    `;
  }

  function renderFooter() {
    const footer = document.querySelector(".site-footer");
    if (!footer) return;

    const year = new Date().getFullYear();
    footer.innerHTML = `
      <div class="footer-inner">
        <div>© ${year} LuminaNexus</div>
        <div class="muted">peshat before abstraction • sources before speculation</div>
      </div>
    `;
  }

  renderHeader();
  renderFooter();
})();
